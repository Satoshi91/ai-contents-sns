# 🎯 AIボイスドラマプラットフォーム開発指揮書

## 📊 現状分析（2024年12月時点）

### ✅ 実装完了済み
- **認証システム**: Firebase Authentication
- **投稿作成機能**: `/compose`ページ（タイトル・キャプション入力）
- **データ保存**: Firestoreへの投稿保存機能（worksコレクション）
- **プロフィール機能**: ユーザープロフィール表示・編集
- **作品表示**: プロフィールページで自分の作品一覧表示
- **基本UIコンポーネント**: Button, Input, TextArea, Card等

### ❌ 未実装（緊急課題）

#### 🚨 **CRUD機能の不完全性**
- **作品編集機能**: `updateWork` 関数が存在しない
- **作品削除機能**: `deleteWork` 関数が存在しない  
- **作品詳細ページ**: 個別作品の詳細表示ページが存在しない

#### 📺 **ホームページの空白状態**
- **投稿一覧表示**: ホームページに作品が表示されない
- **フィード機能**: 全ユーザーの作品を閲覧する機能が未実装

---

## 🎯 **緊急ミッション：CRUD完遂 & ホームフィード実装**

### 【フェーズ1】CRUD機能完成（最優先）⚡
```
目標: 作品の完全な管理機能実現
期間: 1-2日
重要度: 🔥🔥🔥 超高優先
```

#### 1.1 作品編集機能の実装
**ファイル**: `src/lib/firebase/works.ts`  
**追加関数**: `updateWork`
```typescript
export const updateWork = async (
  workId: string,
  input: CreateWorkInput,
  userId: string
): Promise<CreateWorkResult> => {
  // 権限チェック + Firestore更新処理
}
```

#### 1.2 作品削除機能の実装  
**ファイル**: `src/lib/firebase/works.ts`  
**追加関数**: `deleteWork`
```typescript
export const deleteWork = async (
  workId: string,
  userId: string
): Promise<{ success: boolean; error?: string }> => {
  // 権限チェック + Firestore削除処理
}
```

#### 1.3 作品詳細ページの実装
**ファイル**: `src/app/(main)/works/[workId]/page.tsx`  
**機能要件**:
- 作品の詳細情報表示
- 編集・削除ボタン（作成者のみ）
- 再生機能の準備（音声ファイル対応は将来実装）

#### 1.4 プロフィールページでの編集・削除機能追加
**ファイル**: `src/components/features/ProfileDisplay.tsx`  
**追加機能**:
- 各作品に編集・削除ボタンの追加
- 編集モーダルの実装
- 削除確認ダイアログの実装

### 【フェーズ2】ホームフィード実装（高優先）🚀
```
目標: 全ユーザーの作品閲覧機能の実現  
期間: 1-2日
重要度: 🔥🔥 高優先
```

#### 2.1 作品カードコンポーネント作成
**ファイル**: `src/components/features/WorkCard.tsx`  
**要件**:
- 作品情報（タイトル、キャプション、作成者）
- 作成者アバターとプロフィールリンク
- 作成日時（相対時間表示）
- いいね・コメント・シェアボタン
- 作品詳細ページへのリンク

#### 2.2 ホームページ作品フィード実装
**ファイル**: `src/app/(main)/home/page.tsx`  
**実装方針**:
- 既存の `getAllWorks` 関数を活用
- 作品の降順表示（最新順）
- 無限スクロールまたはページネーション
- ローディング・エラー状態の適切な処理

#### 2.3 フィードの最適化
- パフォーマンス最適化（React.memo等）
- リアルタイム更新の検討
- ユーザーのインタラクション追跡

### 【フェーズ3】UX強化（中優先）⚡
```
目標: ユーザー体験の向上  
期間: 1-2日
重要度: 🔥 中優先
```

#### 3.1 検索・フィルタリング機能
- タイトル・作成者での検索
- ジャンル・タグでのフィルタリング

#### 3.2 ソート機能
- 最新順・人気順・再生回数順
- ユーザー設定の保存

---

## 🏗️ 技術アーキテクチャ指針

### データフロー設計
```
【CRUD操作】
作成: compose → Firestore → プロフィール表示
読取: Firestore → WorkCard/詳細ページ表示  
更新: 編集フォーム → updateWork → リアルタイム反映
削除: 確認ダイアログ → deleteWork → UI更新

【ホームフィード】
Firestore(works) → getAllWorks → WorkCard配列 → 無限スクロール
```

### コンポーネント設計方針
- **WorkCard**: 再利用可能な作品表示コンポーネント
- **WorkDetail**: 作品詳細ページでの表示
- **WorkEditModal**: インライン編集機能
- **WorkDeleteDialog**: 削除確認UI

### セキュリティ設計
- **権限チェック**: 編集・削除は作成者のみ
- **Firestore Rules**: uid によるアクセス制御
- **クライアント検証**: 不正操作の防止

---

## 📋 実装チェックリスト

### フェーズ1: CRUD完成
- [ ] `updateWork` 関数実装
- [ ] `deleteWork` 関数実装  
- [ ] `/works/[workId]` 詳細ページ作成
- [ ] プロフィールページに編集・削除機能追加
- [ ] 編集バリデーション実装
- [ ] 削除確認ダイアログ実装

### フェーズ2: ホームフィード  
- [ ] `WorkCard.tsx` コンポーネント作成
- [ ] ホームページフィード実装
- [ ] 無限スクロール実装
- [ ] ローディング・エラー状態実装
- [ ] レスポンシブ対応

### フェーズ3: UX強化
- [ ] 検索機能実装
- [ ] ソート機能実装
- [ ] フィルタリング機能実装

---

## 🚨 リスク管理

### 技術的リスク
- **Firestore制限**: 読み取り・書き込み制限への対応
- **リアルタイム同期**: 複数ユーザー同時編集時の競合
- **パフォーマンス**: 大量データ表示時の最適化

### 対策
- **段階的リリース**: 機能ごとの検証・デプロイ
- **エラーバウンダリ**: UI破綻の防止
- **楽観的更新**: UX向上のためのオプティミスティックUI

---

## 🎯 成功指標（KPI）

### 機能完成度
- ✅ CRUD機能の完全実装（100%）
- ✅ ホームフィード機能の実装
- ✅ レスポンシブ対応（モバイル・デスクトップ）

### ユーザー体験
- ⚡ 初期ロード時間: 3秒以内
- 🔄 CRUD操作レスポンス: 1秒以内
- 📱 モバイル最適化: 完全対応

### データ整合性
- 🔒 権限制御: 100%適切な制御
- 🛡️ バリデーション: 入力データの完全検証
- 🔄 同期: リアルタイムデータ整合性

---

## 🎖️ 指揮官への緊急提言

**現状**: 投稿機能は動作しているが、ユーザーが自分の作品を管理できず、他のユーザーの作品も見ることができない**半機能状態**です。

**最優先実装順序**:

1. **今すぐ**: 作品編集・削除機能（CRUD完遂）
2. **次に**: ホームページでの作品フィード表示  
3. **その後**: UX強化（検索・ソート等）

**指揮官**、まずは **フェーズ1のCRUD機能完成** から着手することを強く推奨します。これにより、ユーザーが自分の作品を完全に管理できるようになります。